function ColorMunch(e){"use strict";function d(e){if(e===undefined||e===null)throw new Error("getThemesFeed(): url argument is required");if(c)t.emit(ColorMunchEvent.FAILED,{detail:{message:"Busy",busy:!0}});else{c=!0;var n=e.replace(a,"");h===null&&(h=new ColorMunchFeedLoader(p));h.on(ColorMunchEvent.FAILED,m);h.on(ColorMunchEvent.COMPLETE,v);h.load(n)}}function v(e){h.un(ColorMunchEvent.FAILED,m);h.un(ColorMunchEvent.COMPLETE,v);if(e.detail&&e.detail.busy){c=!1;t.emit(ColorMunchEvent.FAILED,{detail:e.detail})}else if(e.detail.data&&e.detail.data.items)w(e.detail.data.items);else{c=!1;var n=e.detail&&e.detail.message?e.detail:{message:"getThemesFeed(): unknown error"};t.emit(ColorMunchEvent.FAILED,{detail:n})}}function m(e){c=!1;h.un(ColorMunchEvent.FAILED,m);h.un(ColorMunchEvent.COMPLETE,v);var n=e.detail&&e.detail.message?e.detail:{message:"getThemesFeed(): load error"};t.emit(ColorMunchEvent.FAILED,{detail:n})}function g(e){if(e===undefined||e===null)throw new Error("__getCommentsFeed(): url argument is required");if(c)t.emit(ColorMunchEvent.FAILED,{detail:{message:"Busy",busy:!0}});else{c=!0;var n=e.replace(a,"");h===null&&(h=new ColorMunchFeedLoader(p));h.on(ColorMunchEvent.FAILED,b);h.on(ColorMunchEvent.COMPLETE,y);h.load(n)}}function y(e){h.un(ColorMunchEvent.FAILED,b);h.un(ColorMunchEvent.COMPLETE,y);if(e.detail&&e.detail.busy){c=!1;t.emit(ColorMunchEvent.FAILED,{detail:e.detail})}else if(e.detail.data&&e.detail.data.items)E(e.detail.data.items);else{c=!1;var n=e.detail&&e.detail.message?e.detail:{message:"getCommentsFeed(): unknown error"};t.emit(ColorMunchEvent.FAILED,{detail:n})}}function b(e){c=!1;h.un(ColorMunchEvent.FAILED,b);h.un(ColorMunchEvent.COMPLETE,y);var n=e.detail&&e.detail.message?e.detail:{message:"getCommentsFeed(): load error"};t.emit(ColorMunchEvent.FAILED,{detail:n})}function w(e){var n=e.length;f=[];if(n>0){for(var r=0;r<n;r++){var i=e[r];i.themeSwatches.swatch&&f.push(new ColorMunchTheme(i.themeID,i.themeTitle,i.description,i.themeImage,i.link,i.themeCreatedAt,i.themeEditedAt,i.themeTags,i.themeRating,i.themeDownloadCount,i.themeAuthor.authorID,i.themeAuthor.authorLabel,i.themeSwatches.swatch,p))}c=!1;t.emit(ColorMunchEvent.COMPLETE,{detail:{message:"Themes loaded and ready"}})}else{c=!1;t.emit(ColorMunchEvent.COMPLETE,{detail:{message:"0 themes found",empty:!0}})}}function E(e){var n=e.length;l=[];if(n>0){for(var r=0;r<n;r++){var i=e[r];l.push(new ColorMunchComment(i.comment,i.author,i.postedAt))}c=!1;t.emit(ColorMunchEvent.COMPLETE,{detail:{message:"Comments loaded and ready"}})}else{c=!1;t.emit(ColorMunchEvent.COMPLETE,{detail:{message:"0 comments found",empty:!0}})}}function S(e){var t=!1,n="Invalid list type";switch(e){case ColorMunch.LIST_HIGHEST_RATED:case ColorMunch.LIST_MOST_RECENT:case ColorMunch.LIST_POPULAR:case ColorMunch.LIST_RANDOM:t=!0}return t?!0:n}function x(e,t){var n=!1,r="";switch(e){case ColorMunch.FILTER_THEME_ID:n=u.test(t);r="Invalid themeID";break;case ColorMunch.FILTER_USER_ID:n=u.test(t);r="Invalid userID";break;case ColorMunch.FILTER_EMAIL:n=s.test(t);r="Invalid email address";break;case ColorMunch.FILTER_HEX:n=o.test(t);r="Invalid hex value. Must be in the format 'ABCDEF' or '0xABCDEF'";break;case ColorMunch.FILTER_TAG:case ColorMunch.FILTER_NONE:case ColorMunch.FILTER_TITLE:n=!0;break;default:n=!1;r="Invalid search filter"}return n?!0:r}function T(e,t){var n=!1,r="";switch(e){case ColorMunch.COMMENTS_BY_EMAIL:n=s.test(t);r="Invalid email address";break;case ColorMunch.COMMENTS_BY_THEME_ID:n=u.test(t);r="Invalid themeID. Must contain at least 6 digits";break;default:n=!1;r="Invalid comment search filter"}return n?!0:r}ColorMunchEvent.apply(this);if(e===null||e===undefined||typeof e!="string"||e==="")throw new Error("ColorMunch(): a valid proxyUrl is required.");String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};var t=this,n="https://kuler-api.adobe.com/feeds/rss/get.cfm",r="https://kuler-api.adobe.com/rss/search.cfm",i="https://kuler-api.adobe.com/rss/comments.cfm",s=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,o=/\b0x(?:[0-9A-Fa-f]{6})\b/g,u=/^[-+]?\d*$/,a=/<.*?>/g,f=[],l=[],c=!1,h=null,p=e;t.loadThemes=function(e,r,i,s){e=e!==undefined&&e!==null?e:ColorMunch.LIST_MOST_RECENT;r=r!==undefined&&r!==null?r:ColorMunch.START_INDEX;i=i!==undefined&&i!==null?i:ColorMunch.TIME_SPAN;s=s!==undefined&&s!==null?s:ColorMunch.ITEMS_PER_PAGE;var o=S(e);if(o===!0){var u=n+"?listType="+e+"&startIndex="+r+"&timeSpan="+i+"&itemsPerPage="+s;d(u)}else t.emit(ColorMunchEvent.FAILED,{detail:{message:"loadThemes(): "+o}})};t.searchThemes=function(e,n,i,s){if(e===undefined||e===null)throw new Error("searchThemes(): filter argument is required.");if(n===undefined||n===null)throw new Error("searchThemes(): query argument is required.");i=i!==undefined&&i!==null?i:ColorMunch.START_INDEX;s=s!==undefined&&s!==null?s:ColorMunch.ITEMS_PER_PAGE;var o=x(e,n);if(o===!0){var u=e===ColorMunch.FILTER_NONE?n:e+":"+n,a=r+"?searchQuery="+u+"&startIndex="+i+"&itemsPerPage="+s;d(a)}else t.emit(ColorMunchEvent.FAILED,{detail:{message:"searchThemes(): "+o}})};t.loadComments=function(e,n,r,s){if(e===undefined||e===null)throw new Error("loadComments(): filter argument is required");if(n===undefined||n===null)throw new Error("loadComments(): query argument is required");r=r!==undefined&&r!==null?r:ColorMunch.START_INDEX;s=s!==undefined&&s!==null?s:ColorMunch.ITEMS_PER_PAGE;var o=T(e,n);if(o===!0){var u=i+"?"+e+"="+n+"&startIndex="+r+"&itemsPerPage="+s;g(u)}else t.emit(ColorMunchEvent.FAILED,{detail:{message:"loadComments(): "+o}})};t.getThemeCount=function(){return f.length};t.getThemes=function(){return f};t.getThemeByIndex=function(e){return e>=0&&e<l.length?f[e]:null};t.getRandomTheme=function(){if(f.length>0){var e=Math.floor(Math.random()*f.length);return f[e]}return null};t.getCommentCount=function(){return l.length};t.getComments=function(){return l};t.getCommentByIndex=function(e){return e>=0&&e<l.length?l[e]:null};t.getRandomComment=function(){if(l.length>0){var e=Math.floor(Math.random()*l.length);return l[e]}return null};t.getBusy=function(){return c}}function ColorMunchComment(e,t,n){"use strict";ColorMunchEvent.apply(this);var r=this,i=e,s=t,o=n,u=new Date(n);r.getText=function(){return i};r.getAuthor=function(){return s};r.getPostedDate=function(){return u};r.getPostedAt=function(){return o}}function ColorMunchSwatch(e,t,n,r,i,s,o){"use strict";ColorMunchEvent.apply(this);var u=this,a=null,f=e.substr(0,2)==="0x"?e:"0x"+e,l=e.substr(0,2)==="0x"?"#"+e.substr(2):"#"+e,c=parseInt(f),h=t,p=parseInt(o,10),d=[parseFloat(n),parseFloat(r),parseFloat(i),parseFloat(s)],v=c>>16&255,m=c>>8&255,g=c&255,y={r:v,g:m,b:g},b=Math.max(v,m,g),w=b<192;u.getHexInt=function(){return c};u.getHexString=function(){return l};u.getColorMode=function(){return h};u.getChannels=function(){return d};u.getIndex=function(){return p};u.getRGB=function(){return y};u.getBrightness=function(){return b};u.getElement=function(){if(a===null){a=document.createElement("div");w?a.setAttribute("class","cm-swatch cm-swatch--dark"):a.setAttribute("class","cm-swatch");a.style.backgroundColor=l;a.innerHTML='<span class="cm-swatch-label">'+l+"</span>"}return a};u.getIsDark=function(){return w}}function ColorMunchTheme(e,t,n,r,i,s,o,u,a,f,l,c,h,p){"use strict";function _(e){var t=e.length;A=[];for(var n=0;n<t;n++){var r=e[n];A.push(new ColorMunchSwatch(r.swatchHexColor,r.swatchColorMode,r.swatchChannel1,r.swatchChannel2,r.swatchChannel3,r.swatchChannel4,r.swatchIndex))}}function D(){O.on(ColorMunchEvent.COMPLETE,H);O.on(ColorMunchEvent.FAILED,B)}function P(){O.removeEventListener(ColorMunchEvent.COMPLETE,H);O.removeEventListener(ColorMunchEvent.FAILED,B)}function H(e){P();M=!0;var t=e.detail||{};d.emit(ColorMunchEvent.COMPLETE,{detail:t})}function B(e){P();e.detail&&e.detail.empty&&(M=!0);var t=e.detail||{};d.emit(ColorMunchEvent.FAILED,{detail:t})}ColorMunchEvent.apply(this);var d=this,v=null,m=p,g=e,y=t,b=n,w=r,E=i,S=a,x=f,T=c,N=l,C=u.split(", "),k=new Date(s.substr(4,2)+"/"+s.substr(6,2)+"/"+s.substr(0,4)),L=new Date(o.substr(4,2)+"/"+o.substr(6,2)+"/"+o.substr(0,4)),A=[],O=null,M=!1;C.length===1&&C[0]===""&&(C.length=0);_(h);d.loadThemeComments=function(e,t){e=e!==undefined&&e!==null?e:ColorMunch.START_INDEX;t=t!==undefined&&t!==null?t:ColorMunch.ITEMS_PER_PAGE;O=new ColorMunch(m);D();O.loadComments(ColorMunch.COMMENTS_BY_THEME_ID,g,e,t)};d.getSwatchCount=function(){return A.length};d.getId=function(){return g};d.getTitle=function(){return y};d.getDescription=function(){return b};d.getImage=function(){return w};d.getSwatches=function(){return A};d.getSwatchByIndex=function(e){return e>=0&&e<A.length?A[e]:null};d.getRandomSwatch=function(){if(A.length>0){var e=Math.floor(Math.random()*A.length);return A[e]}return null};d.getLink=function(){return E};d.getAuthor=function(){return T};d.getAuthorId=function(){return N};d.getDownloadCount=function(){return x};d.getRating=function(){return S};d.getTags=function(){return C};d.getCreatedDate=function(){return k};d.getEditedDate=function(){return L};d.getElement=function(){if(v===null){var e=A.length,t,n,r;v=document.createElement("div");v.setAttribute("id","cm-theme_"+g);v.setAttribute("class","cm-theme");v.innerHTML='<span class="cm-theme-label">'+y+"</span>";for(r=0;r<e;r++){n=A[r];t=n.getElement();t.setAttribute("class",t.getAttribute("class")+" cm-swatch--"+(r+1));v.appendChild(t)}}return v};d.getCommentsLoaded=function(){return M};d.getCommentCount=function(){return M?O.getCommentCount():-1};d.getAllComments=function(){return M?O.getAllComments():null};d.getCommentByIndex=function(e){return M?O.getCommentByIndex(e):null};d.getRandomComment=function(){return M?O.getRandomComment():null}}function ColorMunchEvent(){"use strict";var e=this,t={};e.addEventListener=function(e,n){t[e]||(t[e]=[]);t[e].push(n)};e.removeEventListener=function(e,n){var r=-1;if(t[e]){r=t[e].indexOf(n);r!==-1&&t[e].splice(r,1)}};e.fireEvent=function(n,r){var i,s="on"+n.charAt(0).toUpperCase()+n.slice(1);if(t[n])for(i=0;i<t[n].length;i++)t[n][i](r);e[s]&&e[s](r)};e.emit=function(t,n){e.fireEvent(t,n)};e.on=function(t,n){e.addEventListener(t,n)};e.un=function(t,n){e.removeEventListener(t,n)}}function ColorMunchFeedLoader(e){"use strict";function u(o){var u=(new Date).getTime().toString();n="onFetchComplete_"+u;var f=e+"?callback="+n+"&requestid="+Math.floor(Math.random()*999999).toString()+"&request_url="+encodeURIComponent(i);if(r){t.emit(ColorMunchEvent.FAILED,{detail:{message:"A request is already in progress",busy:!0}});return}o||(s=0);r=document.createElement("script");r.type="text/javascript";r.id="tempscript_"+u;r.src=f;window[n]=a;document.body.appendChild(r)}function a(e){document.body.removeChild(r);window[n]=null;r=null;if(e.items){o=e;t.emit(ColorMunchEvent.COMPLETE,{detail:{message:"Complete",data:e}})}else s++>5?t.emit(ColorMunchEvent.FAILED,{detail:{message:"Request for "+i+" failed after 5 attempts."}}):u(!0)}ColorMunchEvent.apply(this);if(e===null||e===undefined||typeof e!="string"||e==="")throw new Error("ColorMunchFeedLoader(): a valid proxyUrl is required.");var t=this,n="",r=null,i="",s=0,o=null;t.load=function(e){(e===null||e===undefined||typeof e!="string"||e==="")&&t.emit(ColorMunchEvent.FAILED,{detail:{message:"load(): a valid requestUrl is required"}});i=e;u()};t.getResponse=function(){return o}}ColorMunch.prototype.getData=function(){return{themes:this.getAllThemes(),comments:this.getAllComments()}};ColorMunch.LIST_HIGHEST_RATED="rating";ColorMunch.LIST_MOST_RECENT="recent";ColorMunch.LIST_RANDOM="random";ColorMunch.LIST_POPULAR="popular";ColorMunch.FILTER_NONE="";ColorMunch.FILTER_THEME_ID="themeID";ColorMunch.FILTER_USER_ID="userID";ColorMunch.FILTER_EMAIL="email";ColorMunch.FILTER_TAG="tag";ColorMunch.FILTER_HEX="hex";ColorMunch.FILTER_TITLE="title";ColorMunch.COMMENTS_BY_THEME_ID="themeID";ColorMunch.COMMENTS_BY_EMAIL="email";ColorMunch.ITEMS_PER_PAGE=20;ColorMunch.START_INDEX=0;ColorMunch.TIME_SPAN=0;ColorMunchComment.prototype.getData=function(){return{text:this.getText(),author:this.getAuthor(),postedDate:this.getPostedDate()}};ColorMunchComment.prototype.toString=function(){return this.getText()+"<br />Author: "+this.getAuthor()+"<br />Posted: "+this.getPostedAt()};ColorMunchSwatch.prototype.getData=function(){return{hexInt:this.getHexInt(),hexString:this.getHexString(),colorMode:this.getColorMode(),channels:this.getChannels(),rgb:this.getRGB(),index:this.getIndex(),element:this.getElement(),isDark:this.getIsDark()}};ColorMunchSwatch.prototype.toString=function(){return this.getHexString()};ColorMunchTheme.prototype.getData=function(){return{element:this.getElement(),id:this.getId(),title:this.getTitle(),description:this.getDescription(),image:this.getImage(),link:this.getLink(),rating:this.getRating(),downloadCount:this.getDownloadCount(),author:this.getAuthor(),authorId:this.getAuthorId(),tags:this.getTags(),createdDate:this.getCreatedDate(),editedDate:this.getEditedDate(),swatches:this.getSwatches(),commentsLoaded:this.getCommentsLoaded(),comments:this.getAllComments()}};ColorMunchTheme.prototype.toString=function(){return this.getDescription()};ColorMunchEvent.COMPLETE="complete";ColorMunchEvent.FAILED="cm.failed";